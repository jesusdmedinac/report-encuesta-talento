---
import ReportLayout from '../../layouts/ReportLayout.astro';
const mdModules = import.meta.glob('../../analisis/graphs/*.md', { eager: true, as: 'raw' });
const imageModules = import.meta.glob('../../analisis/graphs/*.png', { eager: true, import: 'default' });

const graphs = Object.entries(mdModules).map(([filePath, raw]) => {
  const base = filePath.split('/').pop()?.replace('.md', '') ?? '';
  const image = imageModules[`../../analisis/graphs/${base}.png`];
  const lines = raw.split('\n').map(line => line.trim()).filter(Boolean);
  const title = lines.find(line => line.startsWith('# '))?.replace(/^#\s*/, '') ?? `Gráfico ${base}`;
  const bullets = lines.filter(line => line.startsWith('- ')).map(line => line.replace(/^-\s*/, ''));
  const insightIndex = lines.findIndex(line => /^##\s*Insight/i.test(line));
  const insight = insightIndex !== -1 ? lines.slice(insightIndex + 1).join(' ') : '';
  return {
    id: base,
    title,
    image,
    bullets,
    insight
  };
}).sort((a, b) => Number(a.id) - Number(b.id));

const intro = {
  titulo: 'Análisis de Madurez Digital SEP25',
  descripcion: 'Resumen ejecutivo del estudio aplicado a 2.399 colaboradores del Banco de Guayaquil. El análisis combina resultados cuantitativos (dimensiones D1-D4) con comparativos sectoriales y hallazgos cualitativos.'
};

const muestra = [
  { label: 'Participantes', value: '2.399' },
  { label: 'Mujeres', value: '52.4%' },
  { label: 'Hombres', value: '47.6%' },
  { label: 'Pregrado', value: '53.8%' },
  { label: 'Posgrado', value: '24.8%' }
];

const dimensiones = [
  { key: 'D1', nombre: 'Madurez Digital y Adaptabilidad', valor: '7.19', texto: 'Capacidad para absorber cambios tecnológicos y resolver problemas digitales en toda la organización.' },
  { key: 'D2', nombre: 'Competencias Digitales Aplicadas', valor: '7.41', texto: 'Uso de datos, colaboración digital y ciberseguridad por encima del benchmark sectorial.' },
  { key: 'D3', nombre: 'Cultura Tecnológica y Liderazgo', valor: '6.94', texto: 'Liderazgo comprometido, aunque con retos para sostener el aprendizaje continuo y la gestión del cambio.' },
  { key: 'D4', nombre: 'Adopción de Inteligencia Artificial', valor: '7.07', texto: 'Alto interés y preparación para IA; se requiere escalar casos de uso y fortalecer la gobernanza.' }
];
---
<ReportLayout title="Análisis SEP25 · Banco de Guayaquil" current="analysis">
  <main class="analysis-shell">
    <section class="analysis-hero">
      <h1>{intro.titulo}</h1>
      <p>{intro.descripcion}</p>
      <div class="hero-grid">
        {muestra.map(item => (
          <div class="hero-card">
            <div class="hero-value">{item.value}</div>
            <span>{item.label}</span>
          </div>
        ))}
      </div>
      <nav class="toc">
        <a href="#dimensiones">Dimensiones clave</a>
        <a href="#comparativos">Comparativos sectoriales</a>
        <a href="#graficos">Galería de gráficos</a>
      </nav>
    </section>

    <section id="dimensiones" class="analysis-section">
      <h2>Dimensiones clave</h2>
      <div class="dimension-grid">
        {dimensiones.map(dim => (
          <article class="dimension-card">
            <header>
              <span class="badge">{dim.key}</span>
              <strong>{dim.valor}/10</strong>
            </header>
            <h3>{dim.nombre}</h3>
            <p>{dim.texto}</p>
          </article>
        ))}
      </div>
    </section>

    <section id="comparativos" class="analysis-section">
      <h2>Hallazgos comparativos</h2>
      <ul class="highlights">
        <li>Índice global: 7.21/10. Banco de Guayaquil mantiene una ventaja frente al benchmark bancario (6.75/10) con una brecha de mejora de 0.65 puntos hasta la meta avanzada (7.86/10).</li>
        <li>Roles técnicos y de liderazgo lideran el desempeño (7.76 y 7.43), mientras que Operaciones/Admin/Finanzas (7.02) y Comercial/Cliente (5.71 en el módulo especializado) concentran oportunidades.</li>
        <li>La adopción de IA presenta diferencias significativas por nivel educativo (η² = 0.10), lo que demanda programas segmentados de upskilling.</li>
        <li>La cultura digital (6.94) revela un patrón en “U” por edad: los grupos más jóvenes y senior convergen, mientras la mediana edad necesita acompañamiento.</li>
      </ul>
    </section>

    <section id="graficos" class="analysis-section">
      <h2>Galería de gráficos y lecturas</h2>
      <div class="graph-grid">
        {graphs.map(graph => (
          <figure class="graph-card" id={`graph-${graph.id}`}>
            {graph.image ? (
              <img src={graph.image} alt={graph.title} loading="lazy" />
            ) : (
              <div class="graph-placeholder">Sin imagen</div>
            )}
            <figcaption>
              <h3>{graph.title}</h3>
              {graph.bullets.length > 0 && (
                <ul>
                  {graph.bullets.map((bullet, idx) => (<li>{bullet}</li>))}
                </ul>
              )}
              {graph.insight && (<p class="insight">{graph.insight}</p>)}
              <a class="permalink" href={`#graph-${graph.id}`}>#{graph.id.padStart(2, '0')}</a>
            </figcaption>
          </figure>
        ))}
      </div>
    </section>
  </main>

  <style>
    .analysis-shell {
      max-width: 1120px;
      margin: 0 auto;
      padding: 48px 24px 96px;
    }

    .analysis-hero {
      background: var(--card-bg);
      border-radius: 18px;
      border: 1px solid var(--border);
      padding: 36px;
      box-shadow: 0 24px 50px rgba(15, 23, 42, 0.1);
    }

    .analysis-hero h1 {
      font-size: 2.2rem;
      margin-bottom: 12px;
      color: var(--primary);
      letter-spacing: -0.01em;
    }

    .analysis-hero p {
      color: var(--text-secondary);
      margin-bottom: 24px;
      max-width: 680px;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 14px;
    }

    .hero-card {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
      text-align: center;
    }

    .hero-value {
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--primary);
    }

    .hero-card span {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .toc {
      margin-top: 28px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .toc a {
      text-decoration: none;
      color: var(--color-company);
      font-weight: 600;
      background: rgba(37, 99, 235, 0.08);
      padding: 8px 16px;
      border-radius: 999px;
    }

    .analysis-section {
      margin-top: 48px;
      background: var(--card-bg);
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 32px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.08);
    }

    .analysis-section h2 {
      margin-top: 0;
      margin-bottom: 20px;
      color: var(--primary);
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
    }

    .dimension-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
    }

    .dimension-card {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .dimension-card header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .dimension-card .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: rgba(37, 99, 235, 0.12);
      color: var(--color-company);
      font-weight: 700;
    }

    .dimension-card strong {
      font-size: 1.2rem;
      color: var(--primary);
    }

    .dimension-card h3 {
      margin: 0;
      font-size: 1.05rem;
      color: var(--primary);
    }

    .dimension-card p {
      margin: 0;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .highlights {
      margin: 0;
      padding-left: 20px;
      color: var(--text-secondary);
      line-height: 1.55;
    }

    .graph-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .graph-card {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: relative;
    }

    .graph-card img {
      width: 100%;
      height: auto;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .graph-card figcaption {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .graph-card h3 {
      margin: 0;
      font-size: 1rem;
      color: var(--primary);
    }

    .graph-card ul {
      margin: 0;
      padding-left: 18px;
      color: var(--text-secondary);
      font-size: 0.92rem;
      line-height: 1.5;
    }

    .insight {
      margin: 0;
      color: var(--text-secondary);
      font-style: italic;
      font-size: 0.9rem;
    }

    .permalink {
      position: absolute;
      top: 16px;
      right: 16px;
      font-size: 0.75rem;
      color: rgba(15, 23, 42, 0.5);
      text-decoration: none;
    }

    .graph-placeholder {
      background: rgba(148, 163, 184, 0.12);
      border-radius: 10px;
      padding: 40px 20px;
      text-align: center;
      color: var(--text-secondary);
      border: 1px dashed var(--border);
    }

    @media (max-width: 768px) {
      .analysis-shell {
        padding: 32px 18px 72px;
      }

      .analysis-hero,
      .analysis-section {
        padding: 24px;
      }
    }
  </style>
</ReportLayout>
