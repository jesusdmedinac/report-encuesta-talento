---
import { ClassByLevel, type NivelMadurez, type ScaleDecile, scoreToScaleDecile } from "../utils/utils";
const {
    titulo = "Resumen Ejecutivo",
    resumenGeneral = [],
    puntuacionesDimensiones = [],
    puntuacionGeneral = {
        puntuacion: 0,
        etiqueta: "PUNTUACI√ìN GENERAL",
        descripcion: ""
    },
    fortalezas = [],
    oportunidades = [],
} = Astro.props;

const puntuacionGeneralWithScaleDecile = scoreToScaleDecile(puntuacionGeneral.puntuacion, "brechaDigital") as ScaleDecile;
const puntuacionesDimensionesWithScaleDeciles = puntuacionesDimensiones.map((dim: any) => {
    const scaleDecile = scoreToScaleDecile(dim.puntuacion, "brechaDigital") as ScaleDecile;
    return {
        ...dim,
        scaleDecile
    };
});
---
<style>
  .badge { border-radius: 999px; }
  .lvl-low { padding: 0.12rem 0.5rem; background: #fee2e2; color: #7f1d1d; }
  .lvl-mid { padding: 0.12rem 0.5rem; background: #fef3c7; color: #78350f; }
  .lvl-high { padding: 0.12rem 0.5rem; background: #dcfce7; color: #14532d; }
</style>
<section>
    <h2>{titulo}</h2>
    
    <div class="exec-summary">
      {resumenGeneral.map((item: any, index: any) => (
        <p key={index}>{item}</p>
      ))}
    </div>

    <div style="background: white; border-radius: 16px; padding: 25px; margin: 25px 0; box-shadow: 0 8px 25px rgba(0,0,0,0.08); border: 1px solid #f0f0f0;">
        <h3 style="color: var(--primary); margin-bottom: 20px; text-align: center;">Puntuaci√≥n por Dimensiones</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
            {puntuacionesDimensionesWithScaleDeciles.map((dim: any) => (
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 12px;">
                    <div style={`font-size: 2rem; font-weight: 800; color: ${dim.color}; line-height: 1;`}>{dim.scaleDecile?.puntaje || 0}</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">{dim.nombre}</div>
                    <div style="width: 100%; height: 6px; background: #e9ecef; border-radius: 3px; margin-top: 8px;">
                        <div style={`width: ${dim.scaleDecile?.puntaje || 0}%; height: 100%; background: ${dim.color}; border-radius: 3px;`}></div>
                    </div>
                </div>
            ))}
        </div>
        
        <div style="text-align: center; margin-top: 25px; padding: 20px; border-radius: 12px;" class:list={[ClassByLevel[puntuacionGeneralWithScaleDecile?.nivel as NivelMadurez], "badge"]}>
            <div style="font-size: 2.5rem; font-weight: 800; line-height: 1;">{puntuacionGeneralWithScaleDecile?.puntaje || 0}</div>
            <div style="font-size: 1rem; margin-top: 5px; font-weight: 600;">{puntuacionGeneralWithScaleDecile?.nivel || ""}</div>
            <div style="font-size: 0.85rem; margin-top: 5px;">{puntuacionGeneral.descripcion}</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin: 30px 0;">
        <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(16, 185, 129, 0.02)); border-radius: 16px; padding: 25px; border-left: 4px solid #10B981;">
            <h4 style="color: #10B981; margin-bottom: 20px; font-size: 1.2rem; display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 1.5rem;">üí™</span>
                Fortalezas Principales
            </h4>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                {fortalezas.map((item: any, index: any) => (
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="background: #10B981; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 700;">{index + 1}</span>
                        <span style="font-size: 0.9rem;" set:html={item} />
                    </div>
                ))}
            </div>
        </div>

        <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), rgba(245, 158, 11, 0.02)); border-radius: 16px; padding: 25px; border-left: 4px solid #F59E0B;">
            <h4 style="color: #F59E0B; margin-bottom: 20px; font-size: 1.2rem; display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 1.5rem;">üåü</span>
                √Åreas de Mayor Potencial
            </h4>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                {oportunidades.map((item: any, index: any) => (
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="background: #F59E0B; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 700;">{index + 1}</span>
                        <span style="font-size: 0.9rem;" set:html={item} />
                    </div>
                ))}
            </div>
        </div>
    </div>
</section>